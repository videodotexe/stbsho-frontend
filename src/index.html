<html>
	<head>
		<title>Storyboard Shower</title>
		<link href="css/homepage.css" rel="stylesheet" />
	</head>
	<body>
	</body>

	<script>

		const loggedPage = "./storyboards.html";

		// If the session has AccessToken then go to storyboards.html
		const accessToken = window.sessionStorage.getItem("AccessToken");
		if (accessToken) {
			window.location = loggedPage;
		}

		const pageTemplate = `
			<div id="content">
				<div>
					<div id="title">
						storyboard<br/>shower
					</div>
					<div class="global-h3">
						Some cheeky-ass motto that explains what stbsho is.
					</div>
				</div>
				<div>
					<form id="login-form">
						<input 
							class="global-text-input global-h4 large-text-input" 
							type="text" placeholder="Email"
							id="login-email"
						/>
						<input 
							class="global-text-input global-h4 large-text-input" 
							type="password" placeholder="Password" 
							id="login-password"
						/>
						<input
							class="global-button global-button-accent global-h4"
							type="submit" value="Login" id="login-button"
						/>
					</form>
					<div id="register-link" class="global-h4">
						Not a member?
						<a href="register.html">
							Register
						</a>
					</div>
				</div>
			</div>
		`;

		document.body.innerHTML = pageTemplate;

		const loginFormElem = document.getElementById("login-form");
		loginFormElem.onsubmit = event => {
			const emailElem = document.getElementById("login-email");
			const passwordElem = document.getElementById("login-password");
			login(emailElem.value, passwordElem.value)
			.then(() => {
				window.location = loggedPage;
			})
			event.preventDefault();
		}

		function login(email, password) {
			const body = {
				"email": email, 
				"password": password,
			}
			const apiUrl = "https://04uc18437f.execute-api.eu-west-1.amazonaws.com/auth/login"
			return fetch(apiUrl, {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify(body),
			})
			.then(res => res.json())
			.then(json => {
				for (let key in json) {
					window.sessionStorage.setItem(key, json[key]);
				}
			});
		}
	</script>
</html>